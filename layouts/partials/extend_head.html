{{- /* Generate favicons from assets/img/dei_git_pic.png */ -}}
{{- $src := resources.Get "img/dei_git_pic.png" -}}
{{- if $src -}}
  {{- $icon16 := $src.Fit "16x16 png" -}}
  {{- $icon32 := $src.Fit "32x32 png" -}}
  {{- $apple := $src.Fit "180x180 png" -}}
  <link rel="icon" type="image/png" sizes="16x16" href="{{ $icon16.RelPermalink }}">
  <link rel="icon" type="image/png" sizes="32x32" href="{{ $icon32.RelPermalink }}">
  <link rel="apple-touch-icon" sizes="180x180" href="{{ $apple.RelPermalink }}">
{{- end -}}

{{- /* Open Graph / Twitter Card preview meta */ -}}
{{- $p := . -}}
{{- $title := or $p.Params.seo.title $p.Title site.Title -}}
{{- $desc := or $p.Params.seo.description $p.Description (cond (gt (len $p.Summary) 0) ($p.Summary | plainify) "") -}}
{{- $desc = (truncate 180 (replaceRE "\n+" " " ($desc | htmlUnescape | plainify))) -}}

{{- /* Resolve preview image: page images > cover > site.Params.images > profile */ -}}
{{- $imgPath := "" -}}
{{- with $p.Params.images }}{{- $imgPath = index . 0 -}}{{- end -}}
{{- if eq $imgPath "" -}}
  {{- with $p.Params.cover.image }}{{- $imgPath = . -}}{{- end -}}
{{- end -}}
{{- if eq $imgPath "" -}}
  {{- with site.Params.images }}{{- $imgPath = index . 0 -}}{{- end -}}
{{- end -}}
{{- if eq $imgPath "" -}}
  {{- with site.Params.profileMode.imageUrl }}{{- $imgPath = . -}}{{- end -}}
{{- end -}}

{{- $imgURL := "" -}}
{{- if ne $imgPath "" -}}
  {{- $path := $imgPath -}}
  {{- if strings.HasPrefix $path "/" }}{{- $path = (strings.TrimPrefix "/" $path) -}}{{- end -}}
  {{- with resources.Get $path -}}
    {{- $imgURL = .RelPermalink -}}
    {{- $imgAbs := $imgURL | absURL -}}
    <meta property="og:image" content="{{ $imgAbs }}" />
    {{- with .Width }}<meta property="og:image:width" content="{{ . }}" />{{- end -}}
    {{- with .Height }}<meta property="og:image:height" content="{{ . }}" />{{- end -}}
  {{- else -}}
    {{- /* Fallback if not an asset resource (e.g., external or static) */ -}}
    <meta property="og:image" content="{{ $imgPath | absURL }}" />
  {{- end -}}
{{- end -}}

<meta property="og:title" content="{{ $title | plainify }}" />
<meta property="og:description" content="{{ $desc }}" />
<meta property="og:type" content="website" />
<meta property="og:url" content="{{ $p.RelPermalink | absURL }}" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="{{ $title | plainify }}" />
<meta name="twitter:description" content="{{ $desc }}" />
{{- with $imgURL }}<meta name="twitter:image" content="{{ . | absURL }}" />{{- end }}

